



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Event Streams - Debezium - Container inventory legacy app</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#using-debezium-with-event-streams-on-openshift" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Container inventory legacy app" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Container inventory legacy app
            </span>
            <span class="md-header-nav__topic">
              Event Streams - Debezium
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-container-inventory/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Container inventory legacy app" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Container inventory legacy app
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-container-inventory/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Development approach
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Development approach
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../creatingApp/" title="Create foundations" class="md-nav__link">
      Create foundations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Integrations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../mq-kafka/" title="MQ - Kafka" class="md-nav__link">
      MQ - Kafka
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../debezium-postgresql/" title="Postgres - Debezium to kafka" class="md-nav__link">
      Postgres - Debezium to kafka
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Event Streams - Debezium
      </label>
    
    <a href="./" title="Event Streams - Debezium" class="md-nav__link md-nav__link--active">
      Event Streams - Debezium
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#download-the-kafka-connect-configuration-from-event-streams-configure-event-streams" title="Download the Kafka Connect Configuration from Event Streams &amp; Configure Event Streams" class="md-nav__link">
    Download the Kafka Connect Configuration from Event Streams &amp; Configure Event Streams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-kafka-connect-image" title="Build the Kafka Connect Image" class="md-nav__link">
    Build the Kafka Connect Image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upload-the-kafka-connect-image-to-openshift" title="Upload the Kafka Connect Image to OpenShift" class="md-nav__link">
    Upload the Kafka Connect Image to OpenShift
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-kafka-connect-on-openshift" title="Deploy Kafka Connect on OpenShift" class="md-nav__link">
    Deploy Kafka Connect on OpenShift
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-or-install-postgresql" title="Configure or Install PostgreSQL" class="md-nav__link">
    Configure or Install PostgreSQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-postgresql" title="Configure PostgreSQL" class="md-nav__link">
    Configure PostgreSQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-postgresql" title="Install PostgreSQL" class="md-nav__link">
    Install PostgreSQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-a-debezium-kafka-connect-connector" title="Configure a Debezium Kafka Connect Connector" class="md-nav__link">
    Configure a Debezium Kafka Connect Connector
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Solution Deployments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Solution Deployments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../run-local/" title="Deploy and run locally" class="md-nav__link">
      Deploy and run locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mq-cloud/" title="Running MQ on IBM Cloud" class="md-nav__link">
      Running MQ on IBM Cloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openshift/" title="Deploy and run on Openshift" class="md-nav__link">
      Deploy and run on Openshift
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#download-the-kafka-connect-configuration-from-event-streams-configure-event-streams" title="Download the Kafka Connect Configuration from Event Streams &amp; Configure Event Streams" class="md-nav__link">
    Download the Kafka Connect Configuration from Event Streams &amp; Configure Event Streams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-kafka-connect-image" title="Build the Kafka Connect Image" class="md-nav__link">
    Build the Kafka Connect Image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upload-the-kafka-connect-image-to-openshift" title="Upload the Kafka Connect Image to OpenShift" class="md-nav__link">
    Upload the Kafka Connect Image to OpenShift
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-kafka-connect-on-openshift" title="Deploy Kafka Connect on OpenShift" class="md-nav__link">
    Deploy Kafka Connect on OpenShift
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-or-install-postgresql" title="Configure or Install PostgreSQL" class="md-nav__link">
    Configure or Install PostgreSQL
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-postgresql" title="Configure PostgreSQL" class="md-nav__link">
    Configure PostgreSQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-postgresql" title="Install PostgreSQL" class="md-nav__link">
    Install PostgreSQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-a-debezium-kafka-connect-connector" title="Configure a Debezium Kafka Connect Connector" class="md-nav__link">
    Configure a Debezium Kafka Connect Connector
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-container-inventory/edit/master/docs/eventstreams-debezium.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="using-debezium-with-event-streams-on-openshift">Using Debezium with Event Streams on OpenShift</h1>
<p>This guide will show you how to use Debezium with Event Streams. It will do this by demonstrating streaming PostgreSQL changes to an Event Streams topic.</p>
<p>This guide assumes you have the following:</p>
<ul>
<li>Installation of Event Streams on OpenShift</li>
<li>OpenShift CLI &amp; Helm CLI on your client machine</li>
<li>Docker installed on your client machine</li>
</ul>
<h2 id="download-the-kafka-connect-configuration-from-event-streams-configure-event-streams">Download the Kafka Connect Configuration from Event Streams &amp; Configure Event Streams</h2>
<p>This section will guide you through downloading the Kafka Connect configuration generated by Event Streams.</p>
<ol>
<li>Log in to the IBM Cloud Private Web Console &amp; navigate to your Event Streams Helm Release from Workloads -&gt; Helm Releases.</li>
<li>Launch the Event Streams UI - Inside of the Event Streams Helm Release view, click the Launch button and select <code>admin-ui-https</code>.</li>
<li>From the Event Streams UI, Navigate to Toolbox -&gt; Set up a Kafka Connect environment and follow the instructions on screen. These instructions should guide you through creating topics for Kafka Connect, generating an API key and provide you with your Kafka Connect configuration.</li>
</ol>
<h2 id="build-the-kafka-connect-image">Build the Kafka Connect Image</h2>
<p>This section will guide you through building a Kafka Connect Image that includes the Debezium PostgreSQL connector. This section will use the package downloaded in the previous section.</p>
<ol>
<li>
<p>Unzip the <code>kafkaconnect.zip</code> file that was downloaded
<div class="codehilite"><pre><span></span>  $ unzip kafkaconnect.zip -d kafkaconnect
</pre></div></p>
</li>
<li>
<p>Delete the zipped <code>kafkaconnect</code> package
<div class="codehilite"><pre><span></span>  $ rm kafkaconnect.zip
</pre></div></p>
</li>
<li>
<p>Download the Debezium PostgreSQL Connector (v0.10.0.CR1) package from Maven Central
<div class="codehilite"><pre><span></span>  $ wget https://repo1.maven.org/maven2/io/debezium/debezium-connector-postgres/0.10.0.CR1/debezium-connector-postgres-0.10.0.CR1-plugin.tar.gz
</pre></div></p>
</li>
<li>
<p>Untar the Debezium PostgreSQL Connector into the <code>kafkaconnect/connectors</code> directory
<div class="codehilite"><pre><span></span>  $ tar -xvzf debezium-connector-postgres-0.10.0.CR1-plugin.tar.gz -C kafkaconnect/connectors
</pre></div></p>
</li>
<li>
<p>Delete the Debezium PostgreSQL Connector tarball
<div class="codehilite"><pre><span></span>  $ rm debezium-connector-postgres-0.10.0.CR1-plugin.tar.gz
</pre></div></p>
</li>
<li>
<p>Build the Kafka Connect image with Docker
<div class="codehilite"><pre><span></span>  $ docker build -t kafka-connect-debezium-postgres:0.0.1 kafkaconnect
</pre></div></p>
</li>
</ol>
<h2 id="upload-the-kafka-connect-image-to-openshift">Upload the Kafka Connect Image to OpenShift</h2>
<p>This section will guide you through uploading the Kafka Connect image to OpenShift. This will require SSH access to a cluster node. For alternative methods, please refer to the <a href="https://docs.openshift.com/container-platform/3.11/dev_guide/managing_images.html">OpenShift documentation</a>.</p>
<ol>
<li>
<p>Package the Docker image built in the last section as a tarball
<div class="codehilite"><pre><span></span>  $ docker save kafka-connect-debezium-postgres:0.0.1 --output kafka-connect-debezium-postgres-0-0-1.tar
</pre></div></p>
</li>
<li>
<p>Upload the image tarball to one of the cluster nodes using SCP. For example a cluster node at <code>192.168.10.2</code> using user <code>root</code>
<div class="codehilite"><pre><span></span>  <span class="err">$</span> <span class="n">scp</span> <span class="n">kafka</span><span class="o">-</span><span class="n">connect</span><span class="o">-</span><span class="n">debezium</span><span class="o">-</span><span class="n">postgres</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mf">1.</span><span class="n">tar</span> <span class="n">root</span><span class="mf">@192.168.10.2</span><span class="o">:/</span><span class="n">root</span><span class="o">/</span>
</pre></div></p>
</li>
<li>
<p>SSH into the cluster node
<div class="codehilite"><pre><span></span>  <span class="err">$</span> <span class="n">ssh</span> <span class="n">root</span><span class="mf">@192.168.10.2</span>
</pre></div></p>
</li>
<li>
<p>Load the uploaded image tarball into the local Docker repository
<div class="codehilite"><pre><span></span>  $ docker load --input kafka-connect-debezium-postgres-0-0-1.tar
</pre></div></p>
</li>
<li>
<p>Login to your OpenShift cluster with the <code>oc</code> command
<div class="codehilite"><pre><span></span>  $ oc login
</pre></div></p>
</li>
<li>
<p>Login to the OpenShift Docker registry, this assumes that the registry is installed at the default location <code>docker-registry.default.svc.cluster.local:5000</code>
<div class="codehilite"><pre><span></span>  $ docker login -u any_value -p $(oc whoami -t) docker-registry.default.svc.cluster.local:5000
</pre></div></p>
</li>
<li>
<p>Tag the Kafka Connect image with an appropriate registry location. Replace <code>your-namespace-here</code> with the namespace where you will deploy Kafka Connect, if deploying to another namespace
<div class="codehilite"><pre><span></span>  $ docker tag kafka-connect-debezium-postgres:0.0.1 docker-registry.default.svc.cluster.local:5000/your-namespace-here/kafka-connect-debezium-postgres:0.0.1
</pre></div></p>
</li>
<li>
<p>Push the image up to the OpenShift Docker registry, replacing <code>your-namespace-here</code> with the namespace you specified in the last step
<div class="codehilite"><pre><span></span>  $ docker push docker-registry.default.svc.cluster.local:5000/your-namespace-here/kafka-connect-debezium-postgres:0.0.1
</pre></div></p>
</li>
</ol>
<h2 id="deploy-kafka-connect-on-openshift">Deploy Kafka Connect on OpenShift</h2>
<p>This section will guide you through deploying Kafka Connect on OpenShift using the image that you uploaded in the last section. Kafka Connect will be exposed as a NodePort service on port <code>30500</code> of your cluster nodes.</p>
<ol>
<li>
<p>Return to the workspace that contains the <code>kafkaconnect</code> directory that was downloaded in the first section, and login to your OpenShift cluster
<div class="codehilite"><pre><span></span>  $ oc login
</pre></div></p>
</li>
<li>
<p>Upload <code>connect-distributed.properties</code> as a Secret in the OpenShift namespace where you will deploy Kafka Connect (replacing <code>your-namespace-here</code>)
<div class="codehilite"><pre><span></span>  $ oc create secret generic --namespace your-namespace-here --from-file kafkaconnect/config/connect-distributed.properties connect-distributed-config
</pre></div></p>
</li>
<li>
<p>Upload <code>connect-log4j.properties</code> as a ConfigMap in the OpenShift namespace where you will deploy Kafka Connect (replacing <code>your-namespace-here</code>)
<div class="codehilite"><pre><span></span>  $ oc create configmap --namespace your-namespace-here --from-file kafkaconnect/config/connect-log4j.properties connect-log4j-config
</pre></div></p>
</li>
<li>
<p>Create a file in your workspace named <code>kafka-connect-deploy.yaml</code> with the following contents. Replace the value of <code>spec.template.spec.containers.0.image</code> with the image name that you uploaded in the last section
<div class="codehilite"><pre><span></span>  # Deployment
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: kafkaconnect-deploy
    labels:
      app: kafkaconnect
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: kafkaconnect
    template:
      metadata:
        labels:
          app: kafkaconnect
      spec:
        securityContext:
          runAsNonRoot: true
          runAsUser: 5000
        containers:
          - name: kafkaconnect-container
            image: docker-registry.default.svc.cluster.local:5000/your-namespace-here/kafka-connect-debezium-postgres:0.0.1
            readinessProbe:
              httpGet:
                path: /
                port: 8083
            livenessProbe:
              httpGet:
                path: /
                port: 8083
            ports:
            - containerPort: 8083
            volumeMounts:
            - name: connect-config
              mountPath: /opt/kafka/config/connect-distributed.properties
              subPath: connect-distributed.properties
            - name: connect-log4j
              mountPath: /opt/kafka/config/connect-log4j.properties
              subPath: connect-log4j.properties
        volumes:
        - name: connect-config
          secret:
            secretName: connect-distributed-config
        - name: connect-log4j
          configMap:
            name: connect-log4j-config

  ---
  # Service
  apiVersion: v1
  kind: Service
  metadata:
    name: kafkaconnect-service
    labels:
      app: kafkaconnect-service
  spec:
    type: NodePort
    ports:
      - name: kafkaconnect
        protocol: TCP
        port: 8083
        nodePort: 30500
    selector:
        app: kafkaconnect
</pre></div></p>
</li>
<li>
<p>Deploy Kafka Connect (replacing <code>your-namespace-here</code>)
<div class="codehilite"><pre><span></span>  $ oc create --namespace your-namespace-here -f kafka-connect-deploy.yaml
</pre></div></p>
</li>
</ol>
<h2 id="configure-or-install-postgresql">Configure or Install PostgreSQL</h2>
<p>This section will give you the minimum required configuration for PostgreSQL by Debezium. If you do not have PostgreSQL, you can proceed to the Installation section.</p>
<h3 id="configure-postgresql">Configure PostgreSQL</h3>
<p>If you already have PostgreSQL installed, you must enable the logical decoding feature of PostgreSQL (v. &gt;=9.4) and enable a logical decoding output plugin. PostgreSQL v.10+ includes the <code>pgoutput</code> logical decoding output plugin by default. If you are on a lower version, you must first install either <a href="https://github.com/debezium/postgres-decoderbufs">decoderbufs</a> or <a href="https://github.com/eulerto/wal2json">wal2json</a>. More information can be found on the Debezium website <a href="https://debezium.io/documentation/reference/0.10/connectors/postgresql.html">here</a></p>
<p>After you have an acceptable local decoding output plugin installed, refer to the Debezium documentation to complete the configuration of your PostgreSQL server <a href="https://debezium.io/documentation/reference/0.10/connectors/postgresql.html#server-configuration">https://debezium.io/documentation/reference/0.10/connectors/postgresql.html#server-configuration</a></p>
<h3 id="install-postgresql">Install PostgreSQL</h3>
<p>If you do not have PostgreSQL installed, you may use a Helm Chart to get a working PostgreSQL instance on your cluster.</p>
<p>This section will guide you through the installation of PostgreSQL using the Stable Helm Chart. You will also add some additional configuration for PostgreSQL necessary for Debezium to read the PostgreSQL transaction log. PostgreSQL will be available on port <code>30600</code> of your cluster nodes. The superuser will be <code>postgres</code>, password is <code>passw0rd</code> and an initial database name of <code>postgres</code>.</p>
<ol>
<li>
<p>Create a PostgreSQL configuration necessary for Debezium. Create a file in your workspace named <code>extended.conf</code> with the following contents:
<div class="codehilite"><pre><span></span>  # extended.conf

  wal_level = logical
  max_wal_senders = 1
  max_replication_slots = 1
</pre></div></p>
</li>
<li>
<p>Create a ConfigMap from the <code>extended.conf</code> file with the following command (replacing <code>your-namespace-here</code>)
<div class="codehilite"><pre><span></span>  $ oc create configmap --namespace your-namepace-here --from-file=extended.conf postgresql-config
</pre></div></p>
</li>
<li>
<p>Install PostgreSQL using the Stable Helm Chart with the following command (replacing <code>your-namespace-here</code>). For more configuration options, refer to the <a href="https://github.com/helm/charts/blob/master/stable/postgresql/README.md">PostgreSQL Helm Chart</a>
<div class="codehilite"><pre><span></span>  $ helm install --name postgres --namespace your-namespace-here --set extendedConfConfigMap=postgresql-config --set service.type=NodePort --set service.nodePort=30600 --set postgresqlPassword=passw0rd --set securityContext.runAsUser=5000 --set volumePermissions.securityContext.runAsUser=5000 stable/postgresql --tls
</pre></div></p>
</li>
<li>
<p>Finally, connect to your PostgreSQL instance with your favorite PostgreSQL client and create a table with data. Note that the <code>psql</code> client is installed on the postgres container. You may <code>exec</code> into the postgres container and use psql from there.
<div class="codehilite"><pre><span></span>  $ oc exec --namespace your-namespace-here -it postgres-postgresql-0 -- /bin/sh
</pre></div>
<div class="codehilite"><pre><span></span>  $ psql login --user postgres
</pre></div></p>
</li>
</ol>
<h2 id="configure-a-debezium-kafka-connect-connector">Configure a Debezium Kafka Connect Connector</h2>
<p>After you have a configured PostgreSQL instance, you may then configure a new Debezium Kafka Connect connector for PostgreSQL. Kafka Connect connectors are configured by making a request to the Kafka Connect API endpoint.</p>
<p>The following shows a configuration of a PostgreSQL instance at <code>postgres-postgresql.your-namespace-here.svc.cluster.local</code> on port <code>5432</code> with username <code>postgres</code> and password <code>passw0rd</code>. The database is <code>postgres</code> with table <code>public.people</code>. In this example, we are using the <code>pgoutput</code> logical decoding output plugin. Also, we are using the <code>cURL</code> HTTP client to make a call to the Kafka Connect API at <code>http://192.168.10.2:30500</code> since <code>192.168.10.2</code> is one our cluster nodes and the Kafka Connect API is exposed as a <code>NodePort</code> on port <code>30500</code>.</p>
<div class="codehilite"><pre><span></span>curl -X POST \
  http://192.168.10.2:30500/connectors \
  -H &#39;Content-Type: application/json&#39; \
  -d &#39;{
    &quot;name&quot;: &quot;people-connector&quot;,
    &quot;config&quot;: {
            &quot;connector.class&quot;: &quot;io.debezium.connector.postgresql.PostgresConnector&quot;,
            &quot;plugin.name&quot;: &quot;pgoutput&quot;,
            &quot;database.hostname&quot;: &quot;postgres-postgresql.your-namespace-here.svc.cluster.local&quot;,
            &quot;database.port&quot;: &quot;5432&quot;,
            &quot;database.user&quot;: &quot;postgres&quot;,
            &quot;database.password&quot;: &quot;passw0rd&quot;,
            &quot;database.dbname&quot;: &quot;postgres&quot;,
            &quot;database.server.name&quot;: &quot;postgres&quot;,
            &quot;table.whitelist&quot;: &quot;public.people&quot;
      }
}&#39;
</pre></div>

<p>You should then be able to return to the Event Streams UI, navigating to the "Topics" section. You can then click on "postgres.public.people" (or whatever your table name is) to see your newly created topic. Then, click on "Messages" to view the messages that Debezium has written to the topic.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../debezium-postgresql/" title="Postgres - Debezium to kafka" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Postgres - Debezium to kafka
              </span>
            </div>
          </a>
        
        
          <a href="../run-local/" title="Deploy and run locally" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Deploy and run locally
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>